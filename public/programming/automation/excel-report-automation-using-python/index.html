<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <meta name="google-site-verification" content="0hFsIlifUylXTWnwQ5sywPUPmRoqdg78M-R-4otV_wc" />

    <title>Automate Excel Reports Using Python - Ankur Sinha</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://ankuroh.com/favicon.png" />
    <link rel="canonical" href="https://ankuroh.com/programming/automation/excel-report-automation-using-python/" />

     <meta name="description" content="This tutorial shows how to automate excel reports using Python. It shows how to automate the task from getting the data to refreshing the Excel report." /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://images2.imgbox.com/bf/65/SqNZIuIp_o.png"/>
    
 
    <meta name="twitter:title" content="Automate Excel Reports Using Python"/>
    <meta name="twitter:description" content="This tutorial shows how to automate excel reports using Python. It shows how to automate the task from getting the data to refreshing the Excel report."/>
    <meta name="twitter:url" content="https://ankuroh.com/programming/automation/excel-report-automation-using-python/" />
    <meta name="twitter:site" content="@"/>

    <meta property="og:site_name" content="" />
    <meta property="og:title" content="Automate Excel Reports Using Python &middot; Ankur Sinha" />
    <meta property="og:url" content="https://ankuroh.com/programming/automation/excel-report-automation-using-python/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="This tutorial shows how to automate excel reports using Python. It shows how to automate the task from getting the data to refreshing the Excel report." />

    <meta property="article:published_time" content="2019-08-21T10:11:20&#43;01:00" />
    

    <meta property="og:image" content="https://images2.imgbox.com/bf/65/SqNZIuIp_o.png"/>


    <meta name="generator" content="Hugo 0.48" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://ankuroh.com/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://ankuroh.com/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    

     

</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/programming/">Programming</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/travelogue/">Travel</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/recipes/">Recipes</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/cv/">CV</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    

                    <a class="social-link" href="https://github.com/ansin218" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    <a class="social-link" href="https://www.linkedin.com/in/ansin218" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 50 512 512"><path d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683 C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615 c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915 s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z" /></svg></a>

                    

                    <a class="social-link" href="https://instagram.com/ansin218" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/></svg></a>

                    <a class="social-link" href="https://stackoverflow.com/users/1592364/ankur-sinha" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-135 22 32 38"><path d="M-128,45.4l16.2,3.4l0.7-3.2l-16.2-3.4L-128,45.4z M-125.9,37.6l15,7l1.4-3l-15-7L-125.9,37.6z     M-121.7,30.2l12.7,10.6l2.1-2.5l-12.7-10.6L-121.7,30.2z M-113.5,22.4l-2.7,2l9.9,13.3l2.7-2L-113.5,22.4z M-128.4,52.9h16.6    v-3.3h-16.6V52.9z"/></svg></a>
                    
                    <a class="social-link" href="https://www.quora.com/profile/Ankur-Sinha-9" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.495 15.682s-.097 1.434-1.39 1.434c-1 0-1.682-.768-2.32-1.765 1.814-1.597 2.966-3.982 2.966-6.646C16.751 3.897 13.001 0 8.377 0 3.752 0 .003 3.897.003 8.705s3.749 8.705 8.374 8.705c.84 0 1.65-.129 2.414-.368.967 1.55 2.195 2.943 4.117 2.943 3.912 0 4.074-4.303 4.074-4.303h-1.487zm-9.118.293c-2.696 0-4.882-3.255-4.882-7.27s2.186-7.27 4.882-7.27c2.696 0 4.882 3.255 4.882 7.27 0 1.597-.346 3.073-.932 4.272-.662-.953-1.456-1.764-2.592-2.022-2.015-.459-3.75.456-4.3.912l.517 1.076s.523-.303 1.82 0c.817.19 1.452 1.334 2.18 2.646a3.459 3.459 0 0 1-1.575.386z"/></svg></a>
        </div>
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post"> 
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2019-08-21">21 August 2019</time>
        </section>
        <h1 class="post-full-title">Automate Excel Reports Using Python</h1>
    </header>

    

    <section class="post-full-content">
        <div class="kg-card-markdown">
        

<p>People working as data analysts/scientists stumble upon requests for reports from different people. While ad-hoc reports are one time thing, reports that need to be sent periodically, be it daily or weekly or monthly, can take quite a lot of time if done manually. Hence, nn this tutorial, I will show how to automate excel reports using Python. The diagram below illustrates a typical excel report automation workflow.</p>

<p><img src="/img/programming/excel-report-automation-pipeline.png" alt="alt text" title="Report Automation Pipeline" /></p>

<h2 id="get-data-from-oracle-using-python">Get Data From Oracle Using Python</h2>

<p>Let us import the necessary libraries and establish a connection to our database with the necessary username and password. This can be done using the following block of code in the case of Oracle database.:</p>

<pre><code class="language-Python">import cx_Oracle

host = 'your-host-name'
port = 'your-port-number-as-integer-without-quotes'
sid = 'your-sid'
tns = cx_Oracle.makedsn(host, port, sid)
db = cx_Oracle.connect('your-username', 'your-password', tns)
</code></pre>

<p>Now that we have established a connection with the database, we will run the query using the <code>pandas</code> library from a file and save it as a CSV file.</p>

<pre><code class="language-Python">import pandas as pd
from pathlib import Path

query = Path('H:/periodic-analysis/analysis-query.sql').read_text()
df = pd.read_sql(query, db)
</code></pre>

<p>If you have CSV or Excel file with your data already, you can also directly do:</p>

<pre><code class="language-Python">import pandas as pd

df = pd.read_csv('path/file.csv')

## or

df = pd.read_excel('path/file.xlsx')
</code></pre>

<h2 id="replace-latest-data-source-of-excel-report">Replace Latest Data Source Of Excel Report</h2>

<p>We have the data from our query or CSV/Excel file in a <code>pandas</code> dataframe currently. We will save this data to a CSV file with the name <code>latest_raw_data.csv</code>.</p>

<pre><code class="language-Python">file_name = 'H:/periodic-analysis/latest_raw_data.csv'
df.to_csv(file_name, sep = '|', index = False)
</code></pre>

<p>It is to be noted that this CSV file acts as the data source for the excel report. This tutorial assumes that you have already created a connection from your excel file to this raw data file.</p>

<h2 id="copy-last-excel-report-file">Copy Last Excel Report File</h2>

<p>Imagine you have the last excel report file that you had sent X days back to someone. You will typically create a copy of this file and then do the necessary changes. We will automate this step using Python as well.</p>

<p>This is a two step process: get the latest file in the directory and create a copy of the latest file in the same directory.</p>

<h3 id="get-latest-file-from-folder-using-python">Get Latest File From Folder Using Python:</h3>

<pre><code class="language-Python">import glob
import os

list_of_files = glob.glob('H:/periodic-reports/final-reports/*')
latest_file = max(list_of_files, key = os.path.getctime)
latest_file = latest_file.split('2018', 1)
latest_file = '2018' + latest_file[1]
</code></pre>

<h3 id="create-copy-of-latest-file-using-python">Create Copy Of Latest File Using Python:</h3>

<pre><code class="language-Python">from shutil import copyfile
import datetime

today_date = datetime.datetime.today().strftime('%Y%m%d')
src = 'H:/periodic-reports/final-reports/' + latest_file
new_file = today_date + '_latest_periodic_report.xlsx'
dst = 'H:/periodic-reports/final-reports/' + new_file
copyfile(src, dst)
</code></pre>

<h2 id="refresh-excel-file-using-python">Refresh Excel File Using Python</h2>

<p>Let us assume you already had a report being sent often that is computed out of this raw CSV data file that we have generated earlier. Many people I have met think, at this step, they must open Excel, click the refresh button, and save the file. What if I tell you that even this step can be automated?</p>

<p>Let us the take the new file we created out of the old file and refresh it using Python itself.</p>

<pre><code class="language-Python">import win32com.client
import time

SourcePathName = 'H:/periodic-reports/final-reports/' + new_file
Application = win32com.client.DispatchEx('Excel.Application')
Application.DisplayAlerts = False
Application.Visible = 1
Workbook = Application.Workbooks.open(SourcePathName)
Workbook.RefreshAll()
time.sleep(20)
Workbook.Save()
Workbook.Close()
Application.Quit()
</code></pre>

<h2 id="send-e-mail-using-python">Send E-Mail Using Python</h2>

<p>The report is now ready. However, there is an additional step. We may want to notify the concerned people that the report is ready and is stored in XYZ shared location. In this case, the shared location is a Windows drive <code>H:</code>. This can vary depending on how the shared network at your end looks like. You can send emails using Python by writing the following block of code:</p>

<pre><code class="language-Python">import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

fromaddr = 'from@whatever.com'
toaddr = 'to@whatever.com'
body = 'The ABC analysis report has been updated and saved in XYZ location'

msg = MIMEMultipart()
msg['From'] = fromaddr
msg['To'] = toaddr
msg['Subject'] = 'Periodic Analysis Report'
msg.attach(MIMEText(body, 'plain'))

server = smtplib.SMTP('smtp-name', 'port-number-without-quotes')
server.starttls()
server.login(fromaddr, 'password')
text = msg.as_string()
server.sendmail(fromaddr, toaddr, text)
server.quit()
</code></pre>

<h2 id="schedule-job-using-python">Schedule Job Using Python</h2>

<p>This can be considered the last step of this tutorial where you will schedule the entire process until now to run, update and send the email by itself. There are many ways to schedule tasks depending on which environment you are in. However, I will demonstrate a Pythonic way to schedule tasks using a Python library called <a href="https://github.com/dbader/schedule">schedule by Dan Bader</a>.</p>

<p>Let us now assume that we need to send our Excel report every Monday at 12 PM. The block of code will look like:</p>

<pre><code class="language-Python">import schedule
import time

def generate_weekly_report():
    # The block of code from querying until sending email notification

schedule.every().monday.at('12:00').do(generate_weekly_report)

while True:
    schedule.run_pending()
    time.sleep(1)
</code></pre>

<p>Save the entire code in a file and run it from a Python terminal. You have now learnt how to refresh an Excel report by automating it using Python.</p>
    
        </div>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="https://ankuroh.com/img/ankur.jpeg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="https://ankuroh.com/">Ankur Sinha</a></h4>
                <p>Playing with data constantly, traveling when I have money and time, cooking to relieve from stress, blogging when I have something to write about.</p>
        </section>
      </section>
    </footer>
</article>
    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      

      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://ankuroh.com/programming/automation/is-web-scraping-legal/">
      <div class="post-card-image" style="background-image: url(https://images2.imgbox.com/c2/5e/Tltzsa8F_o.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://ankuroh.com/programming/automation/is-web-scraping-legal/">
          <header class="post-card-header">
              
              <h2 class="post-card-title">Is Web Scraping Legal</h2>
          </header>
          <section class="post-card-excerpt">
               
                <p>Is web scraping legal? This article answers this popular question and discusses what one needs to look into before scraping the web.</p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://ankuroh.com/img/ankur.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Ankur Sinha</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://ankuroh.com/programming/get-all-records-in-sql-python-and-r/">
      <div class="post-card-image" style="background-image: url(https://ankuroh.com/img/thumbnails/codes-1.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://ankuroh.com/programming/get-all-records-in-sql-python-and-r/">
          <header class="post-card-header">
              
              <h2 class="post-card-title">Get all records in SQL, Python and R</h2>
          </header>
          <section class="post-card-excerpt">
               
                <p>Get all records from a table in SQL or get all records from a dataframe using pandas in Python or R.</p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://ankuroh.com/img/ankur.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Ankur Sinha</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://ankuroh.com/">
      
      <span></span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">Automate Excel Reports Using Python</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>
    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=Automate%20Excel%20Reports%20Using%20Python&amp;url=https%3a%2f%2fankuroh.com%2fprogramming%2fautomation%2fexcel-report-automation-using-python%2f"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fankuroh.com%2fprogramming%2fautomation%2fexcel-report-automation-using-python%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">Ankur Sinha</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
      <a href="/privacy-policy/">Privacy Policy</a>
        
        
        <a href="https://github.com/ansin218" target="_blank" rel="noopener">Github</a>
        <a href="https://www.linkedin.com/in/ansin218" target="_blank" rel="noopener">LinkedIn</a>
        
        <a href="https://instagram.com/ansin218" target="_blank" rel="noopener">Instagram</a>
        <a href="https://stackoverflow.com/users/1592364/ankur-sinha" target="_blank" rel="noopener">Stackoverflow</a>
        <a href="https://www.quora.com/profile/Ankur-Sinha-9" target="_blank" rel="noopener">Quora</a>
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://ankuroh.com/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-128810519-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>


    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
